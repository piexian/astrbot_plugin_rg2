# 更新日志

所有重要的版本更新都会记录在此文件中。

## [1.2.0] - 2025-11-16

### 🎯 重大功能重构
- **统一AI触发器工具**: 将3个独立的AI工具合并为1个 `revolver_game` 统一工具
  - 支持 `action` 参数: `start` (启动游戏)、`join` (参与游戏)、`status` (查询状态)
  - 移除子弹数量参数，所有AI启动均随机装填，防止用户哄骗AI
  - 优化AI工具描述，支持意图识别而非死板关键词匹配

- **事件驱动触发机制**:
  - 使用 `@filter.on_decorating_result` 钩子，精确等待AI消息发送完成
  - 移除复杂的超时机制，采用单一钩子+配置延迟的简洁设计
  - 消除重复执行问题，提供更稳定的用户体验

### ⚙️ 配置优化
- **新增AI工具延迟配置**: `ai_trigger_delay` (默认7秒)
  - 支持自定义AI触发延迟时间，适配不同AI模型响应速度
  - 移除超时保护机制，简化代码逻辑

- **游戏体验优化**:
  - 游戏超时时间从120秒延长至300秒 (5分钟)
  - AI触发延迟从5秒调整为7秒，提供更好的交互节奏

### 🔧 技术改进
- **动态版本管理**: 从 `metadata.yaml` 自动读取版本号，无需手动维护
- **代码优化**: 简化架构，移除冗余的超时任务管理
- **错误处理**: 改进AI触发器的错误处理和日志记录
- **性能提升**: 减少工具数量，降低系统开销

### 🐛 问题修复
- **触发时机**: 修复AI触发器在AI消息发送前执行的问题
- **重复执行**: 解决超时机制与钩子冲突导致的重复执行问题
- **编码问题**: 修复工具文件编码损坏导致的加载失败
- **安全性**: 移除AI工具子弹数量参数，防止权限绕过

### 📝 文档更新
- **配置说明**: 更新README中的配置表格和说明
- **版本号**: 升级至v1.2.0
- **使用指南**: 完善AI工具使用说明和配置指导

## [1.1.1] - 2025-11-14

### 🚀 AI 工具架构优化
- **纯触发器模式重构**
  - 简化 AI 工具职责，仅作为触发器调用主插件
  - 移除冗余参数 (`action`, `detailed`)，简化工具使用
  - 统一错误处理和返回格式，提高维护性
  - AI 响应更快速，用户体验更流畅

### 📝 文档改进
- **README 精简优化**
  - 移除重复的 AI 功能说明
  - 更新架构描述，突出纯触发器模式
  - 版本号更新至 v1.1.1

## [1.1.0] - 2024-11-13

### 🐛 修复
- **修复 AI 工具关键 Bug**
  - 修复 AI 无法正确检测游戏状态的问题
  - 修复 AI 参与游戏时的访问权限错误
  - 修复超时机制和资源清理问题
  - 修复自然语言交互失败的问题

### 🎯 改进
- **AI 功能增强**
  - 添加自定义游戏文本配置支持
  - 优化 AI 工具描述，提高识别准确率
  - 改进消息发送机制，减少冗余回复
- **技术优化**
  - 简化文件结构，移除冗余代码
  - 改进文本管理器性能
  - 空值安全性改进

## [1.0.0] - 2024-11-12

### ✨ 首次发布
- **核心功能**
  - 群聊轮盘赌游戏（6弹膛，1-6发子弹）
  - 管理员权限控制（指定子弹数、走火控制）
  - 随机机制（装填、走火、禁言时长）
  - 超时机制（120秒自动结束）
  - 数据持久化（走火配置保存）

- **AI 自然语言交互**
  - 支持自然语言开启游戏、参与游戏、查询状态
  - AI 工具与指令功能完全一致

- **技术特性**
  - 基于 AstrBot v4.5.0+ 规范开发
  - 全异步处理，类型注解完整
  - 模块化设计，易于维护

---
